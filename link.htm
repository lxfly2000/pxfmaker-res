<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,user-scalable=no"/>
        <title>Link Redirector</title>
    </head>
    <body>
        <p>Redirect to:</p>
        <p id="sURL">URL</p>
    </body>
<script>
var linksData={
    "HelpDoc":"https://github.com/lxfly2000/pxfmaker-res/wiki",
    "RateApp":"https://github.com/lxfly2000/pxfmaker-res/wiki",
    "ReportFeedback":"https://github.com/lxfly2000/pxfmaker-res/issues/new?template=issue{lang}.yml&os={os}",//store={store}"无法使用
    "WhatIsCell":"https://github.com/lxfly2000/pxfmaker-res/wiki/%E5%8D%95%E5%85%83%E6%A0%BC%E7%9A%84%E5%AE%BD%E5%BA%A6%E5%92%8C%E9%AB%98%E5%BA%A6",
    "ExportFontFile":"https://github.com/lxfly2000/pxfmaker-res/wiki/%E4%BD%BF%E7%94%A8FontForge%E5%A4%84%E7%90%86%E5%AF%BC%E5%87%BA%E7%9A%84%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6",
    "SteamWorkshop":"https://steamcommunity.com/app/4145460/workshop/"
};

var keyMatch=location.search.match(/key=([^&=]*)/);
var langMatch=location.search.match(/lang=([^&=]*)/);//zh_CN,zh_TW,en,ja
var platformMatch=location.search.match(/platform=([^&=]*)/);//Android,iOS,Steam,AnyPlatform
if(keyMatch===null){
    document.body.innerText="No URL specified.";
}else{
    var redirectKey=decodeURIComponent(keyMatch[1]);
    sURL.innerText=redirectKey;
    if(linksData[redirectKey]===null||linksData[redirectKey]===undefined){
        document.body.innerText="No URL for “"+redirectKey+"”.";
    }else{
        var link=linksData[redirectKey];
        if(redirectKey==="ReportFeedback"){
            var lang="";
            if(langMatch!==null){
                var langParam=decodeURIComponent(langMatch[1]);
                if(langParam==="zh_CN"||langParam==="zh_TW"||langParam==="ja"){
                    lang="-"+langParam;
                }
            }
            var os="";
            var store="";
            if(platformMatch!==null){
                var platformParam=decodeURIComponent(platformMatch[1]);
                switch(platformParam){
                    case "Android":
                        os="Android";
                        store="Google%20Play";
                        break;
                    case "iOS":
                        os="iOS";
                        store="Apple%20App%20Store";
                        break;
                    case "Steam":
                        os="";
                        store="Steam";
                        break;
                    case "AnyPlatform":
                    default:
                        os="";
                        store="";
                        break;
                }
            }
            link=link.replace("{lang}",lang).replace("{os}",os).replace("{store}",store);
        }else if(redirectKey==="RateApp"){
            if(platformMatch!==null){
                var platformParam=decodeURIComponent(platformMatch[1]);
                switch(platformParam){
                    case "Android":
                        link="https://play.google.com/store/apps/details?id=com.lxfly2000.pxfmaker&reviewId=0";
                        break;
                    /*case "iOS":
                        link="itms-apps://itunes.apple.com/app/id1531762332?action=write-review";
                        break;*/
                    case "Steam":
                        link="https://store.steampowered.com/app/4145460#app_reviews_hash";
                        break;
                    case "AnyPlatform":
                    default:
                        break;
                }
            }
        }
        sURL.innerHTML="<a href=\""+link+"\">"+link+"</a>";
        location.href=link;
    }
}
</script>
</html>
